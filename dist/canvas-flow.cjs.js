var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));let l=require(`react`);l=c(l);let u=require(`@xyflow/react`),d=require(`react-dom`);var f=e=>e.replace(/([a-z0-9])([A-Z])/g,`$1-$2`).toLowerCase(),p=(...e)=>e.filter((e,t,n)=>!!e&&e.trim()!==``&&n.indexOf(e)===t).join(` `).trim(),m={xmlns:`http://www.w3.org/2000/svg`,width:24,height:24,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:2,strokeLinecap:`round`,strokeLinejoin:`round`},h=(0,l.forwardRef)(({color:e=`currentColor`,size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i=``,children:a,iconNode:o,...s},c)=>(0,l.createElement)(`svg`,{ref:c,...m,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:p(`lucide`,i),...s},[...o.map(([e,t])=>(0,l.createElement)(e,t)),...Array.isArray(a)?a:[a]])),g=(e,t)=>{let n=(0,l.forwardRef)(({className:n,...r},i)=>(0,l.createElement)(h,{ref:i,iconNode:t,className:p(`lucide-${f(e)}`,n),...r}));return n.displayName=`${e}`,n},_=g(`ChevronRight`,[[`path`,{d:`m9 18 6-6-6-6`,key:`mthhwq`}]]),v=g(`Clipboard`,[[`rect`,{width:`8`,height:`4`,x:`8`,y:`2`,rx:`1`,ry:`1`,key:`tgr4d6`}],[`path`,{d:`M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2`,key:`116196`}]]),ee=g(`Copy`,[[`rect`,{width:`14`,height:`14`,x:`8`,y:`8`,rx:`2`,ry:`2`,key:`17jyea`}],[`path`,{d:`M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2`,key:`zix9uf`}]]),y=g(`FileText`,[[`path`,{d:`M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z`,key:`1rqfz7`}],[`path`,{d:`M14 2v4a2 2 0 0 0 2 2h4`,key:`tnqrlb`}],[`path`,{d:`M10 9H8`,key:`b1mrlr`}],[`path`,{d:`M16 13H8`,key:`t4e002`}],[`path`,{d:`M16 17H8`,key:`z1uh3a`}]]),b=g(`FolderInput`,[[`path`,{d:`M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1`,key:`fm4g5t`}],[`path`,{d:`M2 13h10`,key:`pgb2dq`}],[`path`,{d:`m9 16 3-3-3-3`,key:`6m91ic`}]]),x=g(`Group`,[[`path`,{d:`M3 7V5c0-1.1.9-2 2-2h2`,key:`adw53z`}],[`path`,{d:`M17 3h2c1.1 0 2 .9 2 2v2`,key:`an4l38`}],[`path`,{d:`M21 17v2c0 1.1-.9 2-2 2h-2`,key:`144t0e`}],[`path`,{d:`M7 21H5c-1.1 0-2-.9-2-2v-2`,key:`rtnfgi`}],[`rect`,{width:`7`,height:`5`,x:`7`,y:`7`,rx:`1`,key:`1eyiv7`}],[`rect`,{width:`7`,height:`5`,x:`10`,y:`12`,rx:`1`,key:`1qlmkx`}]]),S=g(`Image`,[[`rect`,{width:`18`,height:`18`,x:`3`,y:`3`,rx:`2`,ry:`2`,key:`1m3agn`}],[`circle`,{cx:`9`,cy:`9`,r:`2`,key:`af1f0g`}],[`path`,{d:`m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21`,key:`1xmnt7`}]]),C=g(`Layers`,[[`path`,{d:`M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z`,key:`zw3jo`}],[`path`,{d:`M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12`,key:`1wduqc`}],[`path`,{d:`M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17`,key:`kqbvx6`}]]),w=g(`LoaderCircle`,[[`path`,{d:`M21 12a9 9 0 1 1-6.219-8.56`,key:`13zald`}]]),T=g(`MousePointerClick`,[[`path`,{d:`M14 4.1 12 6`,key:`ita8i4`}],[`path`,{d:`m5.1 8-2.9-.8`,key:`1go3kf`}],[`path`,{d:`m6 12-1.9 2`,key:`mnht97`}],[`path`,{d:`M7.2 2.2 8 5.1`,key:`1cfko1`}],[`path`,{d:`M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z`,key:`s0h3yz`}]]),E=g(`Music`,[[`path`,{d:`M9 18V5l12-2v13`,key:`1jmyc2`}],[`circle`,{cx:`6`,cy:`18`,r:`3`,key:`fqmcym`}],[`circle`,{cx:`18`,cy:`16`,r:`3`,key:`1hluhg`}]]),D=g(`PenLine`,[[`path`,{d:`M12 20h9`,key:`t2du7b`}],[`path`,{d:`M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z`,key:`1ykcvy`}]]),O=g(`Play`,[[`polygon`,{points:`6 3 20 12 6 21 6 3`,key:`1oa8hb`}]]),k=g(`Plus`,[[`path`,{d:`M5 12h14`,key:`1ays0h`}],[`path`,{d:`M12 5v14`,key:`s699le`}]]),A=g(`Save`,[[`path`,{d:`M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z`,key:`1c8476`}],[`path`,{d:`M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7`,key:`1ydtos`}],[`path`,{d:`M7 3v4a1 1 0 0 0 1 1h7`,key:`t51u73`}]]),j=g(`Sparkles`,[[`path`,{d:`M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z`,key:`4pj2yx`}],[`path`,{d:`M20 3v4`,key:`1olli1`}],[`path`,{d:`M22 5h-4`,key:`1gvqau`}],[`path`,{d:`M4 17v2`,key:`vumght`}],[`path`,{d:`M5 18H3`,key:`zchphs`}]]),M=g(`Trash2`,[[`path`,{d:`M3 6h18`,key:`d0wm0j`}],[`path`,{d:`M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6`,key:`4alrt4`}],[`path`,{d:`M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2`,key:`v07s0e`}],[`line`,{x1:`10`,x2:`10`,y1:`11`,y2:`17`,key:`1uufr5`}],[`line`,{x1:`14`,x2:`14`,y1:`11`,y2:`17`,key:`xtxkd`}]]),N=g(`Ungroup`,[[`rect`,{width:`8`,height:`6`,x:`5`,y:`4`,rx:`1`,key:`nzclkv`}],[`rect`,{width:`8`,height:`6`,x:`11`,y:`14`,rx:`1`,key:`4tytwb`}]]),P=g(`Upload`,[[`path`,{d:`M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4`,key:`ih7n3h`}],[`polyline`,{points:`17 8 12 3 7 8`,key:`t8dd8p`}],[`line`,{x1:`12`,x2:`12`,y1:`3`,y2:`15`,key:`widbto`}]]),F=g(`Video`,[[`path`,{d:`m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5`,key:`ftymec`}],[`rect`,{x:`2`,y:`6`,width:`14`,height:`12`,rx:`2`,key:`158x01`}]]),I=g(`X`,[[`path`,{d:`M18 6 6 18`,key:`1bl5f8`}],[`path`,{d:`m6 6 12 12`,key:`d8bk6v`}]]);const te=(e=`node`)=>`${e}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,ne=(e,t=[])=>{let n=new Map(t.map(e=>[e.id,e])),r=e.map(e=>{let t=e.groupId,r=t?n.get(t):void 0,i=e.position,a;return r&&(a=r.id,i=e.position),{id:e.id,type:e.type,position:i,parentId:a,extent:a?`parent`:void 0,expandParent:!0,draggable:!0,zIndex:10,width:e.width||250,height:e.height||250,style:{width:e.width?`${e.width}px`:`250px`,height:e.height?`${e.height}px`:`250px`},data:{}}});return[...t.map(e=>({id:e.id,type:`group`,position:e.position,zIndex:-1,draggable:!0,width:e.width,height:e.height,style:{width:e.width,height:e.height},data:{label:e.label,style:e.style}})),...r]},L=(e,t=[])=>{let n=[],r=[],i=new Map(t.map(e=>[e.id,e])),a=new Map;return e.forEach(e=>{if(e.type===`group`){a.set(e.id,{position:e.position});let t=i.get(e.id);r.push({id:e.id,label:t?.label||`Group`,position:e.position,width:e.measured?.width||e.width||200,height:e.measured?.height||e.height||100,style:t?.style})}}),e.forEach(e=>{if(e.type===`group`)return;let t=e.position,r=e.parentId;if(r){let n=a.get(r);n&&(t={x:e.position.x+n.position.x,y:e.position.y+n.position.y})}n.push({id:e.id,type:e.type||`default`,position:t,width:e.measured?.width||e.width||250,height:e.measured?.height||e.height||250,groupId:r})}),{nodes:n,groups:r}},re=e=>e.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle,data:e.data,markerEnd:{type:u.MarkerType.ArrowClosed,width:20,height:20,color:`#888`}})),R=e=>e.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle,data:e.data})),z=e=>{if(e.length===0)return{x:0,y:0,width:0,height:0};let t=1/0,n=1/0,r=-1/0,i=-1/0;return e.forEach(e=>{let a=e.width||200,o=e.height||40;t=Math.min(t,e.position.x),n=Math.min(n,e.position.y),r=Math.max(r,e.position.x+a),i=Math.max(i,e.position.y+o)}),{x:t,y:n,width:r-t,height:i-n}},B=(e,t,n)=>{let{source:r,target:i}=n;if(r===i)return!1;let a=new Map;e.forEach(e=>a.set(e.id,[])),t.forEach(e=>{let t=a.get(e.source)||[];t.push(e.target),a.set(e.source,t)});let o=new Set,s=[i];for(;s.length>0;){let e=s.pop();if(e===r)return!1;if(!o.has(e)){o.add(e);let t=a.get(e)||[];for(let e of t)s.push(e)}}return!0};let V=function(e){return e.TEXT=`text`,e.IMAGE=`image`,e.VIDEO=`video`,e.AUDIO=`audio`,e.UPLOAD=`user-upload`,e}({});var H=o((e=>{var t=Symbol.for(`react.transitional.element`),n=Symbol.for(`react.fragment`);function r(e,n,r){var i=null;if(r!==void 0&&(i=``+r),n.key!==void 0&&(i=``+n.key),`key`in n)for(var a in r={},n)a!==`key`&&(r[a]=n[a]);else r=n;return n=r.ref,{$$typeof:t,type:e,key:i,ref:n===void 0?null:n,props:r}}e.Fragment=n,e.jsx=r,e.jsxs=r})),ie=o((e=>{process.env.NODE_ENV!==`production`&&(function(){function t(e){if(e==null)return null;if(typeof e==`function`)return e.$$typeof===D?null:e.displayName||e.name||null;if(typeof e==`string`)return e;switch(e){case _:return`Fragment`;case ee:return`Profiler`;case v:return`StrictMode`;case S:return`Suspense`;case C:return`SuspenseList`;case E:return`Activity`}if(typeof e==`object`)switch(typeof e.tag==`number`&&console.error(`Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.`),e.$$typeof){case g:return`Portal`;case b:return e.displayName||`Context`;case y:return(e._context.displayName||`Context`)+`.Consumer`;case x:var n=e.render;return e=e.displayName,e||=(e=n.displayName||n.name||``,e===``?`ForwardRef`:`ForwardRef(`+e+`)`),e;case w:return n=e.displayName||null,n===null?t(e.type)||`Memo`:n;case T:n=e._payload,e=e._init;try{return t(e(n))}catch{}}return null}function n(e){return``+e}function r(e){try{n(e);var t=!1}catch{t=!0}if(t){t=console;var r=t.error,i=typeof Symbol==`function`&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||`Object`;return r.call(t,`The provided key is an unsupported type %s. This value must be coerced to a string before using it here.`,i),n(e)}}function i(e){if(e===_)return`<>`;if(typeof e==`object`&&e&&e.$$typeof===T)return`<...>`;try{var n=t(e);return n?`<`+n+`>`:`<...>`}catch{return`<...>`}}function a(){var e=O.A;return e===null?null:e.getOwner()}function o(){return Error(`react-stack-top-frame`)}function s(e){if(k.call(e,`key`)){var t=Object.getOwnPropertyDescriptor(e,`key`).get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function c(e,t){function n(){M||(M=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",t))}n.isReactWarning=!0,Object.defineProperty(e,`key`,{get:n,configurable:!0})}function l(){var e=t(this.type);return N[e]||(N[e]=!0,console.error(`Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.`)),e=this.props.ref,e===void 0?null:e}function u(e,t,n,r,i,a){var o=n.ref;return e={$$typeof:h,type:e,key:t,props:n,_owner:r},(o===void 0?null:o)===null?Object.defineProperty(e,`ref`,{enumerable:!1,value:null}):Object.defineProperty(e,`ref`,{enumerable:!1,get:l}),e._store={},Object.defineProperty(e._store,`validated`,{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,`_debugInfo`,{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,`_debugStack`,{configurable:!1,enumerable:!1,writable:!0,value:i}),Object.defineProperty(e,`_debugTask`,{configurable:!1,enumerable:!1,writable:!0,value:a}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function d(e,n,i,o,l,d){var p=n.children;if(p!==void 0)if(o)if(A(p)){for(o=0;o<p.length;o++)f(p[o]);Object.freeze&&Object.freeze(p)}else console.error(`React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.`);else f(p);if(k.call(n,`key`)){p=t(e);var m=Object.keys(n).filter(function(e){return e!==`key`});o=0<m.length?`{key: someKey, `+m.join(`: ..., `)+`: ...}`:`{key: someKey}`,I[p+o]||(m=0<m.length?`{`+m.join(`: ..., `)+`: ...}`:`{}`,console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,o,p,m,p),I[p+o]=!0)}if(p=null,i!==void 0&&(r(i),p=``+i),s(n)&&(r(n.key),p=``+n.key),`key`in n)for(var h in i={},n)h!==`key`&&(i[h]=n[h]);else i=n;return p&&c(i,typeof e==`function`?e.displayName||e.name||`Unknown`:e),u(e,p,i,a(),l,d)}function f(e){p(e)?e._store&&(e._store.validated=1):typeof e==`object`&&e&&e.$$typeof===T&&(e._payload.status===`fulfilled`?p(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function p(e){return typeof e==`object`&&!!e&&e.$$typeof===h}var m=require(`react`),h=Symbol.for(`react.transitional.element`),g=Symbol.for(`react.portal`),_=Symbol.for(`react.fragment`),v=Symbol.for(`react.strict_mode`),ee=Symbol.for(`react.profiler`),y=Symbol.for(`react.consumer`),b=Symbol.for(`react.context`),x=Symbol.for(`react.forward_ref`),S=Symbol.for(`react.suspense`),C=Symbol.for(`react.suspense_list`),w=Symbol.for(`react.memo`),T=Symbol.for(`react.lazy`),E=Symbol.for(`react.activity`),D=Symbol.for(`react.client.reference`),O=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=Object.prototype.hasOwnProperty,A=Array.isArray,j=console.createTask?console.createTask:function(){return null};m={react_stack_bottom_frame:function(e){return e()}};var M,N={},P=m.react_stack_bottom_frame.bind(m,o)(),F=j(i(o)),I={};e.Fragment=_,e.jsx=function(e,t,n){var r=1e4>O.recentlyCreatedOwnerStacks++;return d(e,t,n,!1,r?Error(`react-stack-top-frame`):P,r?j(i(e)):F)},e.jsxs=function(e,t,n){var r=1e4>O.recentlyCreatedOwnerStacks++;return d(e,t,n,!0,r?Error(`react-stack-top-frame`):P,r?j(i(e)):F)}})()})),U=o(((e,t)=>{process.env.NODE_ENV===`production`?t.exports=H():t.exports=ie()})),W=U(),G=[{type:V.TEXT,label:`æ–‡æœ¬`,icon:(0,W.jsx)(D,{size:16})},{type:V.IMAGE,label:`å›¾ç‰‡`,icon:(0,W.jsx)(S,{size:16})},{type:V.VIDEO,label:`è§†é¢‘`,icon:(0,W.jsx)(F,{size:16})},{type:V.AUDIO,label:`éŸ³é¢‘`,icon:(0,W.jsx)(E,{size:16})},{type:V.UPLOAD,label:`ä¸Šä¼ `,icon:(0,W.jsx)(P,{size:16})}];const ae=({onAddNode:e,availableTypes:t=G,position:n,onClose:r})=>{let[i,a]=(0,l.useState)(!1),o=(0,l.useRef)(null),s=!!n,c=s||i;return(0,l.useEffect)(()=>{if(s&&r){let e=e=>{o.current&&!o.current.contains(e.target)&&r()};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)}},[s,r]),s?(0,W.jsx)(`div`,{ref:o,style:{position:`fixed`,left:n.x,top:n.y,background:`#222`,border:`1px solid #444`,borderRadius:8,padding:8,display:`flex`,flexDirection:`column`,gap:4,boxShadow:`0 4px 20px rgba(0,0,0,0.6)`,zIndex:1e3,minWidth:140},children:t.map(t=>(0,W.jsxs)(`div`,{onClick:()=>{e(t.type),s||a(!1)},style:{padding:`8px 12px`,borderRadius:4,cursor:`pointer`,color:`#eee`,fontSize:14,transition:`background 0.2s`,display:`flex`,alignItems:`center`,gap:10},onMouseEnter:e=>e.currentTarget.style.background=`#444`,onMouseLeave:e=>e.currentTarget.style.background=`transparent`,children:[t.icon,(0,W.jsx)(`span`,{children:t.label})]},t.type))}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(`div`,{style:{position:`absolute`,left:24,top:`50%`,transform:`translateY(-50%)`,width:48,height:48,borderRadius:`50%`,background:i?`#666`:`#333`,border:`1px solid #444`,color:`#fff`,display:`flex`,alignItems:`center`,justifyContent:`center`,cursor:`pointer`,boxShadow:`0 4px 12px rgba(0,0,0,0.5)`,zIndex:100,transition:`all 0.2s`},onClick:()=>a(!i),onMouseEnter:e=>e.currentTarget.style.background=i?`#666`:`#444`,onMouseLeave:e=>e.currentTarget.style.background=i?`#666`:`#333`,title:`Add Node`,children:(0,W.jsx)(k,{size:24,style:{transform:i?`rotate(45deg)`:`none`,transition:`transform 0.2s`}})}),c&&(0,W.jsx)(`div`,{style:{position:`absolute`,left:84,top:`50%`,transform:`translateY(-50%)`,background:`#222`,border:`1px solid #444`,borderRadius:8,padding:8,display:`flex`,flexDirection:`column`,gap:4,boxShadow:`0 4px 20px rgba(0,0,0,0.6)`,zIndex:100,minWidth:140},children:t.map(t=>(0,W.jsxs)(`div`,{onClick:()=>{e(t.type),a(!1)},style:{padding:`8px 12px`,borderRadius:4,cursor:`pointer`,color:`#eee`,fontSize:14,transition:`background 0.2s`,display:`flex`,alignItems:`center`,gap:10},onMouseEnter:e=>e.currentTarget.style.background=`#444`,onMouseLeave:e=>e.currentTarget.style.background=`transparent`,children:[t.icon,(0,W.jsx)(`span`,{children:t.label})]},t.type))})]})},oe=({items:e,position:t,onClose:n})=>{let r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=e=>{r.current&&!r.current.contains(e.target)&&n()};return document.addEventListener(`mousedown`,e),()=>document.removeEventListener(`mousedown`,e)},[n]),(0,W.jsx)(`div`,{ref:r,className:`canvas-context-menu`,style:{position:`fixed`,top:t.y,left:t.x,zIndex:1e3,backgroundColor:`#222`,border:`1px solid #444`,borderRadius:`8px`,boxShadow:`0 4px 20px rgba(0,0,0,0.6)`,padding:`8px`,minWidth:`140px`,display:`flex`,flexDirection:`column`,gap:`4px`},children:e.map((e,t)=>(0,W.jsxs)(`div`,{className:`context-menu-item ${e.disabled?`disabled`:``}`,onClick:()=>{e.disabled||(e.onClick(),n())},style:{padding:`8px 12px`,borderRadius:`4px`,cursor:e.disabled?`not-allowed`:`pointer`,opacity:e.disabled?.5:1,display:`flex`,justifyContent:`space-between`,alignItems:`center`,fontSize:`14px`,color:`#eee`,transition:`background 0.2s`},onMouseEnter:t=>{e.disabled||(t.currentTarget.style.backgroundColor=`#444`)},onMouseLeave:t=>{e.disabled||(t.currentTarget.style.backgroundColor=`transparent`)},children:[(0,W.jsxs)(`div`,{style:{display:`flex`,alignItems:`center`,gap:`8px`},children:[e.icon&&(0,W.jsx)(`span`,{style:{display:`flex`,alignItems:`center`},children:e.icon}),(0,W.jsx)(`span`,{children:e.label})]}),e.shortcut&&(0,W.jsx)(`span`,{style:{color:`#999`,fontSize:`12px`,marginLeft:`10px`},children:e.shortcut})]},t))})};var K=(0,l.createContext)(null);const se=({children:e,...t})=>(0,W.jsx)(K.Provider,{value:t,children:e}),ce=()=>{let e=(0,l.useContext)(K);if(!e)throw Error(`useCanvasContext must be used within a CanvasProvider`);return e};function q(e,t){let n=(0,l.useRef)(e),r=(0,l.useRef)(void 0);return(0,l.useEffect)(()=>{n.current=e},[e]),(0,l.useCallback)((...e)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n.current(...e)},t)},[t])}const le=(0,l.memo)(e=>{let{id:t,data:n,selected:r,style:i}=e,{config:a,components:o,readOnly:s,onNodeRun:c,runningNodeId:d,isExecuting:f,onNodeDataChange:p,inspectingNodeId:m,mediaMap:h,mediaEmitter:g,updateNodeMedia:_,renderNodeInspector:v}=ce(),{setNodes:ee,getNode:y}=(0,u.useReactFlow)(),b=(0,u.useEdges)(),[x,S]=(0,l.useState)(()=>{let e=h.get(t);return e&&Object.keys(e).length>0?e:n||{}});(0,l.useEffect)(()=>{let e=e=>{S(e)};return g.on(t,e),()=>g.off(t,e)},[t,g]);let C=e.type||`default`,T=a.nodeDefinitions.find(e=>e.type===C);if(!T)return(0,W.jsxs)(`div`,{style:{padding:10,border:`1px solid red`,borderRadius:4,background:`#fff0f0`},children:[`Unknown node type: `,C]});let E=o[T.component],D=q((e,t)=>{p&&p(e,t)},500),O=e=>{S(t=>({...t,...e})),D(t,e)},k=b.some(e=>e.source===t||e.target===t),A=(0,u.useNodesData)((0,l.useMemo)(()=>b.filter(e=>e.target===t).map(e=>e.source),[b,t]));(0,l.useMemo)(()=>A?(Array.isArray(A)?A:[A]).map(e=>{if(!e)return null;let t=a.nodeDefinitions.find(t=>t.type===e.type);return{id:e.id,type:e.type,label:t?.label,data:e.data}}).filter(e=>!!e):[],[A,a.nodeDefinitions]);let j={nodeId:t,data:{...n,...x},selected:!!r,isConnected:k,onChange:O,onRun:c?()=>c(t):void 0,style:i};return(0,W.jsxs)(`div`,{className:`canvas-node ${r?`selected`:``}`,style:{width:`100%`,height:`100%`},children:[v&&(0,W.jsx)(u.NodeToolbar,{isVisible:t===m&&!s,position:u.Position.Bottom,children:v({nodeId:t,node:{id:t,type:C,position:{x:0,y:0},data:x}})}),(0,W.jsx)(`div`,{className:`canvas-node-label`,children:T.label}),(0,W.jsx)(u.Handle,{type:`target`,position:u.Position.Left,className:`canvas-handle`}),(0,W.jsxs)(`div`,{className:`canvas-node-body`,style:{position:`relative`},children:[E?(0,W.jsx)(E,{...j}):(0,W.jsxs)(`div`,{style:{padding:10},children:[`Missing Component: `,T.component]}),(x._loading||x._executionStatus===`running`)&&!x.src&&!x.output&&(0,W.jsxs)(`div`,{className:`cf-upload-loading-overlay`,style:{position:`absolute`,top:0,left:0,width:`100%`,height:`100%`,background:`rgba(0,0,0,0.7)`,display:`flex`,flexDirection:`column`,alignItems:`center`,justifyContent:`center`,zIndex:20,color:`#fff`,gap:8,borderRadius:`inherit`},children:[(0,W.jsx)(w,{className:`cf-spinner`,size:24,style:{animation:`spin 1s linear infinite`}}),(0,W.jsx)(`span`,{style:{fontSize:12},children:`Running...`}),(0,W.jsx)(`style`,{children:`@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`})]}),x._error&&(0,W.jsxs)(`div`,{className:`cf-node-error-overlay`,style:{position:`absolute`,top:0,left:0,width:`100%`,height:`100%`,background:`rgba(220, 38, 38, 0.9)`,display:`flex`,flexDirection:`column`,alignItems:`center`,justifyContent:`center`,zIndex:20,color:`#fff`,gap:8,borderRadius:`inherit`,padding:12},children:[(0,W.jsx)(`span`,{style:{fontSize:14,fontWeight:600},children:`âš ï¸ Error`}),(0,W.jsx)(`span`,{style:{fontSize:12,textAlign:`center`,wordBreak:`break-word`},children:x._error})]})]}),(0,W.jsx)(u.Handle,{type:`source`,position:u.Position.Right,className:`canvas-handle`})]})}),ue=({actions:e,className:t=``,style:n,visible:r=!0})=>!r||e.length===0?null:(0,W.jsx)(`div`,{className:`canvas-node-toolbar ${t}`,style:n,onMouseDown:e=>e.stopPropagation(),children:e.map(e=>{let t=e.icon;return(0,W.jsxs)(`button`,{className:`canvas-node-toolbar-item ${e.className||``}`,onClick:e.onClick,title:e.title||e.label,children:[e.icon&&(0,W.jsx)(`span`,{className:`toolbar-item-icon`,children:l.default.isValidElement(e.icon)?e.icon:(0,W.jsx)(t,{size:14})}),e.label&&(0,W.jsx)(`span`,{className:`toolbar-item-label`,children:e.label})]},e.id)})}),de=(0,l.memo)(({id:e,data:t,selected:n})=>{let{setNodes:r}=(0,u.useReactFlow)(),{onGroupAction:i}=ce(),[a,o]=(0,l.useState)(!1),[s,c]=(0,l.useState)(t.label||`Group`),d=t.style,f=(0,l.useCallback)(()=>{o(!1),r(t=>t.map(t=>t.id===e?{...t,data:{...t.data,label:s}}:t)),i&&i(`update`,{id:e,label:s})},[e,s,r,i]),p=(0,l.useCallback)(t=>{t.stopPropagation(),i&&i(`ungroup`,{id:e})},[e,i]),m=(0,l.useCallback)(t=>{t.stopPropagation(),i&&i(`run`,{id:e})},[e,i]),h=(0,l.useMemo)(()=>[{id:`run`,label:`æ•´ç»„æ‰§è¡Œ`,icon:O,onClick:m,className:`text-green`},{id:`save`,label:`ä¿å­˜`,icon:A,onClick:t=>{t.stopPropagation(),i&&i(`save`,{id:e})}},{id:`ungroup`,label:`è§£ç»„`,icon:N,onClick:p}],[m,p]),g=t.toolbarActions||h,_=(0,l.useCallback)((t,n)=>{i&&i(`update`,{id:e,width:n.width,height:n.height,style:{...d,width:n.width,height:n.height}})},[e,d,i]);return(0,W.jsxs)(`div`,{style:{width:`100%`,height:`100%`,backgroundColor:d?.backgroundColor||`rgba(30, 30, 30, 0.6)`,border:n?`1px solid #ffffff`:`1px solid rgba(255,255,255,0.1)`,borderRadius:12,position:`relative`,transition:`all 0.2s ease`,boxShadow:n?`0 0 0 2px rgba(255, 255, 255, 0.2)`:`none`},children:[(0,W.jsx)(u.NodeResizer,{minWidth:100,minHeight:100,isVisible:!!n,lineStyle:{border:`none`},handleStyle:{width:10,height:10,borderRadius:2},color:`#ffffff`,onResizeEnd:_}),(0,W.jsxs)(`div`,{style:{position:`absolute`,top:-34,left:0,right:0,height:30,display:`flex`,alignItems:`center`,justifyContent:`space-between`,pointerEvents:`none`},children:[(0,W.jsx)(`div`,{style:{padding:`4px 8px`,backgroundColor:`rgba(0,0,0,0.5)`,borderRadius:4,color:`#ccc`,fontSize:12,cursor:`text`,fontWeight:500,pointerEvents:`auto`,display:`flex`,alignItems:`center`,maxWidth:`60%`},onDoubleClick:()=>o(!0),children:a?(0,W.jsx)(`input`,{autoFocus:!0,value:s,onChange:e=>c(e.target.value),onBlur:f,onKeyDown:e=>e.key===`Enter`&&f(),onMouseDown:e=>e.stopPropagation(),style:{background:`transparent`,border:`none`,color:`inherit`,outline:`none`,width:`100%`,minWidth:50}}):(0,W.jsx)(`span`,{style:{whiteSpace:`nowrap`,overflow:`hidden`,textOverflow:`ellipsis`},children:t.label})}),(0,W.jsx)(ue,{actions:g,visible:!0,style:{marginLeft:`auto`,opacity:n?1:0,transition:`opacity 0.2s`,pointerEvents:n?`auto`:`none`}})]})]})}),fe=({selectedNodes:e,onCreateGroup:t})=>{let{flowToScreenPosition:n}=(0,u.useReactFlow)(),r=e.filter(e=>e.type!==`group`);if(r.length<2)return null;let i=z(r.map(e=>({position:e.position,width:e.measured?.width||e.width||0,height:e.measured?.height||e.height||0}))),a=n({x:i.x+i.width/2,y:i.y});return(0,W.jsx)(`div`,{style:{position:`absolute`,left:a.x,top:a.y-40,transform:`translate(-50%, -100%)`,zIndex:2e3,pointerEvents:`all`},children:(0,W.jsxs)(`button`,{onClick:e=>{e.stopPropagation(),t()},style:{display:`flex`,alignItems:`center`,gap:6,padding:`8px 16px`,backgroundColor:`#1a1a1a`,color:`white`,border:`1px solid #333`,borderRadius:20,cursor:`pointer`,boxShadow:`0 4px 12px rgba(0,0,0,0.5)`,fontSize:13,fontWeight:500,outline:`none`},onMouseEnter:e=>e.currentTarget.style.backgroundColor=`#2a2a2a`,onMouseLeave:e=>e.currentTarget.style.backgroundColor=`#1a1a1a`,children:[(0,W.jsx)(x,{size:14}),`ç¼–ç»„`]})})};function pe({nodes:e,edges:t,setEdges:n,setNodes:r,onEdgeAdd:i,onNodeAdd:a,config:o,rfInstance:s}){let[c,d]=(0,l.useState)(!1),[f,p]=(0,l.useState)({isOpen:!1,position:{x:0,y:0},source:null}),m=(0,l.useRef)(null),h=(0,l.useCallback)((e,t)=>{let n=o.nodeDefinitions.find(t=>t.type===e),r=o.nodeDefinitions.find(e=>e.type===t);return!n||!r?!0:!(n.connectionRules?.allowedTargets&&!n.connectionRules.allowedTargets.includes(t)||r.connectionRules?.allowedSources&&!r.connectionRules.allowedSources.includes(e))},[o.nodeDefinitions]),g=(0,l.useCallback)(n=>{if(n.source===n.target)return!1;let r=n.source,i=n.target,a=e.find(e=>e.id===r),o=e.find(e=>e.id===i);return a&&o&&!h(a.type||`default`,o.type||`default`)?!1:B(e.map(e=>({id:e.id})),t.map(e=>({source:e.source,target:e.target})),{source:r,target:i})},[e,t,h]);return{isConnecting:c,connectionMenu:f,setConnectionMenu:p,isValidConnection:g,onConnect:(0,l.useCallback)(e=>{if(!e.source||!e.target){console.warn(`Skipping invalid connection attempt: missing source or target`);return}if(g(e)){let t={...e,markerEnd:{type:u.MarkerType.ArrowClosed,width:20,height:20,color:`#888`}};n(e=>(0,u.addEdge)(t,e)),i&&i({id:`e-${e.source}-${e.target}`,source:e.source,target:e.target,data:{}})}},[n,g,i]),onConnectStart:(0,l.useCallback)((e,t)=>{m.current=t,d(!0)},[]),onConnectEnd:(0,l.useCallback)(e=>{if(d(!1),e.target.classList.contains(`react-flow__pane`)&&m.current&&s){let{clientX:t,clientY:n}=e;p({isOpen:!0,position:{x:t,y:n},source:{...m.current,handleType:m.current.handleType}})}},[s]),handleMenuAddNode:(0,l.useCallback)(e=>{if(!s)return;let{position:t,source:c}=f,l=s.screenToFlowPosition({x:t.x,y:t.y});l.x-=100,l.y-=50;let d=o.nodeDefinitions.find(t=>t.type===e),h=d?.width||250,g=d?.height||250,_=`node-${Date.now()}`,v={id:_,type:e,position:l,width:h,height:g,style:{width:`${h}px`,height:`${g}px`},data:{}};if(r(e=>e.concat(v)),a){let{nodes:e}=L([v],[]);e.length>0&&a(e[0])}if(c?.nodeId){let e;e=c.handleType===`target`?{id:`e-${_}-${c.nodeId}`,source:_,target:c.nodeId,targetHandle:c.handleId,markerEnd:{type:u.MarkerType.ArrowClosed,width:20,height:20,color:`#888`}}:{id:`e-${c.nodeId}-${_}`,source:c.nodeId,target:_,sourceHandle:c.handleId,markerEnd:{type:u.MarkerType.ArrowClosed,width:20,height:20,color:`#888`}},n(t=>(0,u.addEdge)(e,t)),i&&i({id:e.id,source:e.source,target:e.target,data:{}})}p(e=>({...e,isOpen:!1})),m.current=null},[f,s,r,n,a,i,o.nodeDefinitions]),availableNodeTypes:(0,l.useMemo)(()=>{let t=o.nodeDefinitions.map(e=>({type:e.type,label:e.label}));if(!f.source||!f.source.nodeId)return t;let n=f.source.nodeId,r=e.find(e=>e.id===n);if(!r)return t;let i=f.source.handleType;return t.filter(e=>i===`target`?h(e.type,r.type||`default`):h(r.type||`default`,e.type))},[o.nodeDefinitions,f.source,e,h])}}const J=l.default.forwardRef(({initialFlow:e,readOnly:t=!1,onChange:n,onSelectionChange:r,renderEmpty:i,onNodeAdd:a,onNodeMove:o,onNodeDelete:s,onNodeDataChange:c,onEdgeAdd:d,onEdgeDelete:f,onGroupAdd:p,onGroupDelete:m,onGroupUngroup:h,onGroupUpdate:g},_)=>{let{config:y,onNodeDataChange:S}=ce(),[C,w,T]=(0,u.useNodesState)([]),[E,D,O]=(0,u.useEdgesState)([]),[k,A]=(0,l.useState)(null),{isConnecting:j,connectionMenu:N,setConnectionMenu:P,isValidConnection:F,onConnect:I,onConnectStart:B,onConnectEnd:V,handleMenuAddNode:H,availableNodeTypes:ie}=pe({nodes:C,edges:E,setEdges:D,setNodes:w,onEdgeAdd:d,onNodeAdd:a,config:y,rfInstance:k}),[U,G]=(0,l.useState)(null),[K,se]=(0,l.useState)(null),[q,ue]=(0,l.useState)({x:0,y:0}),[J,Y]=(0,l.useState)(null),X=(0,l.useRef)([]);(0,l.useEffect)(()=>{e&&(w(ne(e.nodes,e.groups)),D(re(e.edges)),X.current=e.groups||[])},[]);let Z=(0,l.useRef)(n);(0,l.useEffect)(()=>{Z.current=n},[n]),(0,l.useEffect)(()=>{if(Z.current){let{nodes:e,groups:t}=L(C,X.current),n={nodes:e,edges:R(E),groups:t};Z.current(n)}},[C,E]),(0,l.useEffect)(()=>{let e=e=>{ue({x:e.clientX,y:e.clientY})};return window.addEventListener(`mousemove`,e),()=>window.removeEventListener(`mousemove`,e)},[]);let me=(0,l.useMemo)(()=>{let e={group:de};return y.nodeDefinitions.forEach(t=>{e[t.type]=le}),e},[y.nodeDefinitions]),he=(0,l.useCallback)(e=>{T(e),e.forEach(e=>{e.type===`remove`&&(C.find(t=>t.id===e.id)?.type===`group`?m&&m(e.id):s&&s(e.id))})},[T,s,m,C]),ge=(0,l.useCallback)(e=>{O(e),e.forEach(e=>{e.type===`remove`&&f&&f(e.id)})},[O,f]),_e=(0,l.useCallback)(({nodes:e})=>{if(e.length>0){let t=e[0];t.type===`group`?Y(null):Y(t.id)}else Y(null);r&&r(e.filter(e=>e.type!==`group`).map(e=>e.id))},[r]),ve=(0,l.useCallback)((e,t,n)=>{if(t.type===`group`){g&&g({id:t.id,position:t.position,width:t.measured?.width||t.width,height:t.measured?.height||t.height});return}if(o){let{nodes:e}=L(n,X.current),r=e.find(e=>e.id===t.id);r&&o(r)}if(t.parentId&&g){let e=n.find(e=>e.id===t.parentId);e&&e.measured&&(g({id:e.id,position:e.position,width:e.measured.width,height:e.measured.height}),console.log(`[ç¼–ç»„è‡ªåŠ¨æ‰©å±•] ä¿å­˜ç¼–ç»„ ${e.id} çš„æ–°å°ºå¯¸:`,{width:e.measured.width,height:e.measured.height}))}},[o,g,C,X]),ye=(0,l.useCallback)(e=>{e.detail===2&&!t&&P({isOpen:!0,position:{x:e.clientX,y:e.clientY},source:null}),G(null)},[t]),Q=(0,l.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),G({isOpen:!0,position:{x:e.clientX,y:e.clientY},type:t.type===`group`?`group`:`node`,targetId:t.id})},[]),be=(0,l.useCallback)(e=>{e.preventDefault();let t=C.filter(e=>e.selected&&e.type!==`group`);G({isOpen:!0,position:{x:e.clientX,y:e.clientY},type:t.length>1?`multi`:`pane`})},[C]),xe=(0,l.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),G({isOpen:!0,position:{x:e.clientX,y:e.clientY},type:`edge`,targetId:t.id})},[]),$=(0,l.useCallback)(()=>{let e=C.filter(e=>e.selected&&e.type!==`group`);if(e.length===0)return;let{nodes:t}=L(C,X.current),n=new Map(t.map(e=>[e.id,e])),r=new Set;e.forEach(e=>{e.parentId&&r.add(e.parentId)});let i=new Map;e.forEach(e=>{let t=n.get(e.id);t&&i.set(e.id,t)}),r.size>0&&t.forEach(e=>{e.groupId&&r.has(e.groupId)&&e.type!==`group`&&i.set(e.id,e)});let a=Array.from(i.values()),o=z(a.map(e=>({position:e.position,width:200,height:100}))),s=new Map(C.map(e=>[e.id,e])),c=z(a.map(e=>{let t=s.get(e.id);return{position:e.position,width:t?.measured?.width||t?.width,height:t?.measured?.height||t?.height}})),l=a.some(e=>{let t=s.get(e.id);return!!(t?.measured||t?.width||t?.height)})?c:o,u=te(`group`),d={id:u,label:`æ–°å»ºåˆ†ç»„`,position:{x:l.x-20,y:l.y-20},width:l.width+40,height:l.height+40};p&&p(d),X.current=[...X.current.filter(e=>!r.has(e.id)),d],r.forEach(e=>{m&&m(e)});let f={id:u,type:`group`,position:d.position,width:d.width,height:d.height,zIndex:-1,data:{},style:{width:d.width,height:d.height,zIndex:-1},selected:!0,draggable:!0};w(e=>[f,...e.filter(e=>e.type!==`group`||!r.has(e.id)).map(e=>{if(i.has(e.id)){let t=n.get(e.id),r=t?.position.x??e.position.x,i=t?.position.y??e.position.y;return{...e,parentId:u,extent:`parent`,expandParent:!0,draggable:!0,position:{x:r-d.position.x,y:i-d.position.y},selected:!1}}return e})]),G(null)},[C,w,p,m,S]),Se=(0,l.useCallback)(e=>{let t=e||U?.targetId||C.find(e=>e.selected&&e.type===`group`)?.id;if(!t)return;let{nodes:n}=L(C,X.current),r=new Map(n.map(e=>[e.id,e])),i=C.filter(e=>e.parentId===t).map(e=>e.id);h&&h(t,i),X.current=X.current.filter(e=>e.id!==t),w(e=>e.filter(e=>e.id!==t).map(e=>{if(e.parentId===t){let t=r.get(e.id),n=t?.position.x??e.position.x,i=t?.position.y??e.position.y;return{...e,parentId:void 0,position:{x:n,y:i}}}return e})),G(null)},[U,C,w,h,S]),Ce=(0,l.useCallback)(()=>{let e=U?.type===`node`?U.targetId:null;if(!e&&J&&(e=J),e){let t=C.find(t=>t.id===e);t&&se(t)}},[U,C,J]),we=(0,l.useCallback)(()=>{if(K&&k){let e;e=U?k.screenToFlowPosition({x:U.position.x,y:U.position.y}):k.screenToFlowPosition({x:q.x,y:q.y});let t=te(),n={...K,id:t,position:e,selected:!0,data:{}};if(w(e=>e.map(e=>({...e,selected:!1})).concat(n)),Y(t),a){let[e]=L([n],X.current).nodes;a(e)}}},[K,k,U,q,w,a]),Te=(0,l.useCallback)(()=>{let e,t=!1,n=!1;if(U)e=U.targetId,t=U.type===`edge`,n=U.type===`group`;else{let r=C.find(e=>e.selected),i=E.find(e=>e.selected);r?(e=r.id,n=r.type===`group`):i&&(e=i.id,t=!0)}e&&(t?(D(t=>t.filter(t=>t.id!==e)),f&&f(e)):n?(w(t=>t.filter(t=>!(t.id===e||t.parentId===e))),D(t=>t.filter(t=>{let n=C.find(n=>n.id===t.source&&(n.id===e||n.parentId===e)),r=C.find(n=>n.id===t.target&&(n.id===e||n.parentId===e));return!n&&!r})),m&&m(e)):(w(t=>t.filter(t=>t.id!==e)),D(t=>t.filter(t=>t.source!==e&&t.target!==e)),s&&s(e)),G(null))},[U,C,E,w,D,s,f,m]);(0,l.useEffect)(()=>{let e=e=>{if(t)return;let n=document.activeElement;n&&(n.tagName===`INPUT`||n.tagName===`TEXTAREA`||n.getAttribute(`contenteditable`)===`true`)||((e.ctrlKey||e.metaKey)&&e.key===`c`?Ce():(e.ctrlKey||e.metaKey)&&e.key===`v`?we():(e.ctrlKey||e.metaKey)&&e.key===`g`&&(e.preventDefault(),$()))};return window.addEventListener(`keydown`,e),()=>window.removeEventListener(`keydown`,e)},[Ce,we,$,t]);let Ee=(0,l.useMemo)(()=>{let e=[],t=U?.type===`edge`;return U?.type===`multi`&&e.push({label:`åˆ›å»ºåˆ†ç»„ (Group)`,onClick:$,icon:(0,W.jsx)(b,{size:16}),shortcut:`Ctrl+G`}),(U?.type===`node`||U?.type===`edge`)&&e.push({label:`å¤åˆ¶ (Copy)`,onClick:Ce,disabled:U.type!==`node`,icon:(0,W.jsx)(ee,{size:16}),shortcut:`Ctrl+C`}),(U?.type===`pane`||U?.type===`node`)&&e.push({label:`ç²˜è´´ (Paste)`,onClick:we,disabled:!K||t,icon:(0,W.jsx)(v,{size:16}),shortcut:`Ctrl+V`}),e.push({label:`åˆ é™¤ (Delete)`,onClick:Te,icon:(0,W.jsx)(M,{size:16}),shortcut:`Del`}),U?.type===`group`&&e.push({label:`è§£æ•£åˆ†ç»„ (Ungroup)`,onClick:()=>Se(U.targetId),icon:(0,W.jsx)(x,{size:16})}),e},[U,K,Ce,we,Te,$,Se]);return l.default.useImperativeHandle(_,()=>({fitView:()=>k?.fitView(),getViewport:()=>k?.getViewport(),setFlow:e=>{w(ne(e.nodes,e.groups)),D(re(e.edges)),X.current=e.groups||[]},getFlow:()=>{let{nodes:e,groups:t}=L(C,X.current);return{nodes:e,edges:R(E),groups:t}},ungroup:e=>Se(e)}),[k,w,D,Se,C,E]),(0,W.jsxs)(`div`,{className:`canvas-flow-wrapper ${j?`is-connecting`:``}`,style:{backgroundColor:y.style?.background},children:[(0,W.jsxs)(u.ReactFlow,{nodes:C,edges:E,onNodesChange:he,onEdgesChange:ge,onConnect:I,onConnectStart:B,onConnectEnd:V,onNodeDragStop:ve,isValidConnection:F,onPaneClick:ye,onNodeContextMenu:Q,onPaneContextMenu:be,onEdgeContextMenu:xe,onInit:A,nodeTypes:me,onSelectionChange:_e,fitView:!0,nodesDraggable:!t,nodesConnectable:!t,deleteKeyCode:[`Backspace`,`Delete`],selectionKeyCode:[`Shift`],children:[(0,W.jsx)(u.Background,{}),(0,W.jsx)(fe,{selectedNodes:C.filter(e=>e.selected&&e.type!==`group`),onCreateGroup:$}),(0,W.jsx)(u.Controls,{}),C.length===0&&i&&(0,W.jsx)(`div`,{className:`cf-empty-state-overlay`,children:i})]}),N.isOpen&&(0,W.jsx)(ae,{position:N.position,onAddNode:H,availableTypes:ie,onClose:()=>P(e=>({...e,isOpen:!1}))}),U?.isOpen&&(0,W.jsx)(oe,{items:Ee,position:U.position,onClose:()=>G(null)})]})});J.displayName=`CanvasEditor`;var Y=class{config;constructor(e){this.config=e}async runFlow(e,t){if(this.config.runFlow)return this.config.runFlow(e);let n={};for(let r of e.nodes){t?.(r.id,`running`);try{let i=await this.runSingleNode(r,e,n);n[r.id]=i,t?.(r.id,`success`)}catch(e){throw console.error(`Node ${r.id} execution failed:`,e),t?.(r.id,`error`),e}}return n}async runSingleNode(e,t,n){if(!this.config.runNode)return console.warn(`No runNode implementation provided, skipping execution`),{output:null};let r={node:e,flow:t,incoming:t.edges.filter(t=>t.target===e.id).map(e=>n[e.source]?.output)};return this.config.runNode(r)}},X=class{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){let n=this.listeners.get(e);n&&(n.delete(t),n.size===0&&this.listeners.delete(e))}emit(e,t){let n=this.listeners.get(e);n&&n.forEach(e=>e(t))}batchEmit(e){e.forEach(({nodeId:e,data:t})=>{this.emit(e,t)})}clear(){this.listeners.clear()}getListenerCount(){let e=0;return this.listeners.forEach(t=>{e+=t.size}),e}};const Z=({title:e=`å°è¯•ï¼š`,items:t,onAction:n})=>{let[r,i]=(0,l.useState)(null);return(0,W.jsxs)(`div`,{className:`cf-node-empty-state`,children:[(0,W.jsx)(`div`,{className:`cf-node-empty-title`,children:e}),(0,W.jsx)(`div`,{className:`cf-node-empty-menu`,children:t.map(e=>{let t=r===e.id,a=e.icon;return(0,W.jsxs)(`div`,{className:`cf-menu-item ${t?`hovered`:``}`,onMouseEnter:()=>i(e.id),onMouseLeave:()=>i(null),onClick:t=>{t.stopPropagation(),n(e.id)},children:[(0,W.jsx)(`span`,{className:`cf-menu-item-icon`,children:(0,W.jsx)(a,{size:14})}),(0,W.jsx)(`span`,{className:`cf-menu-item-label`,children:e.label}),t&&(0,W.jsx)(`span`,{className:`cf-menu-item-arrow`,children:(0,W.jsx)(_,{size:14})})]},e.id)})})]})},me=({data:e,isConnected:t,onChange:n})=>{let[r,i]=(0,l.useState)(!1),a=t||e.isInteracted,o=[{id:`edit`,icon:D,label:`è‡ªå·±ç¼–å†™å†…å®¹`},{id:`text-to-video`,icon:F,label:`æ–‡ç”Ÿè§†é¢‘`},{id:`image-to-prompt`,icon:S,label:`å›¾ç‰‡åæŽ¨æç¤ºè¯`},{id:`text-to-audio`,icon:E,label:`æ–‡ç”ŸéŸ³ä¹`}];return a?(0,W.jsx)(`div`,{className:`cf-text-node-container`,onDoubleClick:()=>i(!0),children:r?(0,W.jsx)(`textarea`,{className:`nodrag cf-text-node-input`,autoFocus:!0,onBlur:()=>i(!1),placeholder:`è¾“å…¥æ–‡æœ¬æˆ–è€…ç¼–è¾‘ç”Ÿæˆç»“æžœ...`,value:e.text||``,onChange:e=>n({text:e.target.value}),onKeyDown:e=>e.stopPropagation()}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(`div`,{className:`cf-text-node-display ${e.text?``:`placeholder`}`,children:e.text||`åŒå‡»è¾“å…¥æ–‡æœ¬...`}),(0,W.jsx)(`div`,{className:`cf-text-node-overlay`,children:`åŒå‡»ç¼–è¾‘`})]})}):(0,W.jsx)(Z,{items:o,onAction:e=>{e===`edit`?(n({isInteracted:!0}),i(!0)):console.log(`Action triggered:`,e)}})},he=({isOpen:e,onClose:t,src:n,type:r})=>((0,l.useEffect)(()=>(e?document.body.style.overflow=`hidden`:document.body.style.overflow=`unset`,()=>{document.body.style.overflow=`unset`}),[e]),!e||!n?null:(0,d.createPortal)((0,W.jsx)(`div`,{className:`cf-media-modal-overlay`,onClick:t,children:(0,W.jsxs)(`div`,{className:`cf-media-modal-content`,onClick:e=>e.stopPropagation(),children:[(0,W.jsx)(`button`,{className:`cf-media-modal-close`,onClick:t,children:(0,W.jsx)(I,{size:24})}),(0,W.jsxs)(`div`,{className:`cf-media-modal-body`,children:[r===`image`&&(0,W.jsx)(`img`,{src:n,alt:`Preview`,className:`cf-media-modal-image`}),r===`video`&&(0,W.jsx)(`video`,{src:n,controls:!0,className:`cf-media-modal-video`,autoPlay:!0}),r===`audio`&&(0,W.jsxs)(`div`,{className:`cf-media-modal-audio-wrapper`,children:[(0,W.jsx)(`div`,{className:`cf-media-modal-audio-icon`,children:`ðŸŽµ`}),(0,W.jsx)(`audio`,{src:n,controls:!0,className:`cf-media-modal-audio`,autoPlay:!0})]})]})]})}),document.body)),ge=({data:e,isConnected:t,onChange:n})=>{let r=(0,l.useRef)(null),[i,a]=(0,l.useState)(!1),o=[{id:`img-to-img`,icon:S,label:`å›¾ç”Ÿå›¾`},{id:`img-to-video`,icon:S,label:`å›¾ç”Ÿè§†é¢‘`},{id:`remove-bg`,icon:C,label:`å›¾ç‰‡æ¢èƒŒæ™¯`},{id:`first-frame-video`,icon:F,label:`é¦–å¸§å›¾ç”Ÿè§†é¢‘`}],s=e.src||e.output;return s||t?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(`div`,{className:`cf-media-node-container`,onDoubleClick:()=>s&&a(!0),title:`åŒå‡»æŸ¥çœ‹å¤§å›¾`,children:s&&(0,W.jsx)(`img`,{ref:r,src:s,alt:`generated`,className:`cf-media-node-content`,onLoad:e=>{let t=e.currentTarget;t.naturalWidth&&t.naturalHeight&&n({_contentSize:{width:t.naturalWidth,height:t.naturalHeight}})},style:{display:`block`,cursor:`zoom-in`}})}),(0,W.jsx)(he,{isOpen:i,onClose:()=>a(!1),src:s,type:`image`})]}):(0,W.jsx)(Z,{items:o,onAction:e=>console.log(`Image action:`,e)})},_e=({data:e,isConnected:t,onChange:n})=>{let r=(0,l.useRef)(null),[i,a]=(0,l.useState)(!1),o=[{id:`first-last-frame-to-video`,icon:C,label:`é¦–å°¾å¸§ç”Ÿæˆè§†é¢‘`},{id:`first-frame-to-video`,icon:j,label:`é¦–å¸§ç”Ÿæˆè§†é¢‘`}],s=t||e.output||e.src,c=e.src||e.output;return s?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(`div`,{className:`cf-media-node-container`,title:`åŒå‡»å…¨å±é¢„è§ˆ`,children:c&&(0,W.jsx)(`video`,{ref:r,src:c,controls:!0,controlsList:`nofullscreen`,className:`cf-media-node-content`,onLoadedMetadata:e=>{let t=e.currentTarget;t.videoWidth&&t.videoHeight&&n({_contentSize:{width:t.videoWidth,height:t.videoHeight}})},style:{display:`block`},onDoubleClick:e=>{e.preventDefault(),e.stopPropagation(),c&&a(!0)}})}),(0,W.jsx)(he,{isOpen:i,onClose:()=>a(!1),src:c,type:`video`})]}):(0,W.jsx)(Z,{items:o,onAction:e=>console.log(`Video action:`,e)})},ve=({data:e,isConnected:t})=>{let[n,r]=(0,l.useState)(!1),i=[{id:`audio-to-video`,icon:E,label:`éŸ³é¢‘ç”Ÿè§†é¢‘`}],a=t||e.output||e.src,o=e.src||e.output;return a?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(`div`,{className:`cf-media-node-container`,onDoubleClick:()=>o&&r(!0),title:`åŒå‡»æ‰“å¼€æ’­æ”¾å™¨`,style:{cursor:`pointer`},children:o&&(0,W.jsx)(`audio`,{src:o,controls:!0,className:`cf-media-node-content`,style:{width:`100%`,marginTop:`auto`,marginBottom:`auto`}})}),(0,W.jsx)(he,{isOpen:n,onClose:()=>r(!1),src:o,type:`audio`})]}):(0,W.jsx)(Z,{items:i,onAction:e=>console.log(`Audio action:`,e)})},ye=({data:e,onChange:t})=>{let[n,r]=(0,l.useState)(!1),[i,a]=(0,l.useState)(!1),o=e.params?.action,s=e.params?.accept||`*`;return(0,W.jsxs)(`div`,{className:`cf-upload-container ${e.output?`has-content`:``}`,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[i&&(0,W.jsxs)(`div`,{className:`cf-upload-loading-overlay`,children:[(0,W.jsx)(`div`,{className:`cf-spinner`}),(0,W.jsx)(`span`,{children:`Uploading...`})]}),e.output?(0,W.jsxs)(`div`,{className:`cf-upload-content-wrapper`,children:[(()=>{if(!e.output)return null;let t=e.fileType||``,n=t.startsWith(`image/`),r=t.startsWith(`video/`),i=t.startsWith(`audio/`);return n?(0,W.jsx)(`img`,{src:e.output,alt:`uploaded`,className:`cf-upload-preview-image`}):r?(0,W.jsx)(`video`,{src:e.output,className:`cf-upload-preview-video`,controls:!0}):i?(0,W.jsxs)(`div`,{className:`cf-upload-preview-audio`,children:[(0,W.jsx)(E,{size:48,strokeWidth:1.5}),(0,W.jsx)(`audio`,{src:e.output,controls:!0,style:{maxWidth:`90%`}})]}):(0,W.jsx)(`div`,{className:`cf-upload-preview-file`,children:(0,W.jsx)(y,{size:48,strokeWidth:1.5})})})(),n&&(0,W.jsx)(`div`,{onClick:n=>{n.stopPropagation(),e.output&&e.output.startsWith(`blob:`)&&URL.revokeObjectURL(e.output),t({output:null,fileName:null,fileType:null})},className:`cf-upload-delete-btn`,title:`ç§»é™¤æ–‡ä»¶`,children:(0,W.jsx)(I,{size:14})})]}):(0,W.jsxs)(`label`,{className:`cf-upload-placeholder`,children:[(0,W.jsx)(`input`,{type:`file`,style:{display:`none`},onChange:async e=>{let n=e.target.files?.[0];if(n)if(o){a(!0);try{let e=new FormData;e.append(`file`,n);let r=await fetch(o,{method:`POST`,body:e});if(!r.ok)throw Error(`Upload failed: ${r.statusText}`);let i=await r.json(),a=i.url||i.data?.url||i.fileUrl||i.data?.file_url;if(!a){console.warn(`Upload successful but could not find URL in response:`,i),alert(`Upload successful but URL not found in response. See console.`);return}t({output:a,src:a,fileName:n.name,fileType:n.type,_uploadResult:i.data})}catch(e){console.error(`Upload error:`,e),alert(`ä¸Šä¼ å¤±è´¥: ${e.message}`)}finally{a(!1)}}else t({output:URL.createObjectURL(n),fileName:n.name,fileType:n.type})},accept:s}),(0,W.jsx)(P,{size:24}),(0,W.jsx)(`span`,{className:`cf-upload-label-text`,children:`ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶`}),s!==`*`&&(0,W.jsx)(`span`,{className:`cf-upload-subtext`,style:{fontSize:10,color:`#444`,marginTop:4},children:s})]})]})},Q=e=>{switch(e){case V.TEXT:return{text:``,resourceType:`text/plain`};case V.IMAGE:return{src:``,resourceType:`image/png`};case V.VIDEO:return{src:``,resourceType:`video/mp4`};case V.AUDIO:return{src:``,resourceType:`audio/mp3`};case V.UPLOAD:return{src:``,resourceType:``};default:return{}}},be={TextNode:me,ImageNode:ge,VideoNode:_e,AudioNode:ve,UploadNode:ye},xe={style:{background:`#0f1115`},nodeDefinitions:[{type:V.TEXT,label:`æ–‡æœ¬`,component:`TextNode`,width:280,height:220,defaultData:Q(V.TEXT),connectionRules:{allowedTargets:[V.IMAGE,V.VIDEO]}},{type:V.IMAGE,label:`å›¾ç‰‡`,component:`ImageNode`,width:260,height:260,defaultData:Q(V.IMAGE),connectionRules:{allowedSources:[V.TEXT,V.UPLOAD],allowedTargets:[V.VIDEO]}},{type:V.VIDEO,label:`è§†é¢‘`,component:`VideoNode`,width:300,height:200,defaultData:Q(V.VIDEO),connectionRules:{allowedSources:[V.TEXT,V.IMAGE]}},{type:V.UPLOAD,label:`ä¸Šä¼ `,component:`UploadNode`,width:240,height:200,defaultData:Q(V.UPLOAD)}]},$=l.default.forwardRef((e,t)=>{let{initialFlow:n={nodes:[],edges:[]},config:r=xe,components:i=be,execution:a={},mode:o=`edit`,ui:s={showToolbar:!0},renderEmpty:c,renderNodeInspector:u,onChange:d,onSave:f,onRunFlow:p,onNodeRun:m,onGroupRun:h,onGroupSave:g,onSelectionChange:_,onNodeAdd:v,onNodeDelete:ee,onNodeMove:y,onNodeDataChange:b,onEdgeAdd:x,onEdgeDelete:S,onGroupAdd:C,onGroupDelete:w,onGroupUngroup:T,onGroupUpdate:E,className:D,style:O}=e,[k,A]=(0,l.useState)(n),[j,M]=(0,l.useState)(!1),[N,P]=(0,l.useState)(null),[F,I]=(0,l.useState)(null),ne=(0,l.useRef)(new Y(a)),L=(0,l.useRef)(null),re=(0,l.useRef)(``),R=(0,l.useRef)(new Map),z=(0,l.useRef)(new X),B=(0,l.useCallback)(e=>{let t=L.current?.getFlow?.();return t&&t.nodes.find(t=>t.id===e)||null},[]),V=(0,l.useCallback)((e,t,n)=>{let r=B(e);if(!r)return console.warn(`[${n}] èŠ‚ç‚¹ä¸å­˜åœ¨: ${e}`),null;let i=Array.isArray(t)?t:[t];return i.includes(r.type)?r:(console.error(`[${n}] èŠ‚ç‚¹ ${e} çš„ç±»åž‹æ˜¯ "${r.type}"ï¼Œä¸ç¬¦åˆè¦æ±‚ã€‚`,`æœŸæœ›çš„ç±»åž‹: ${i.join(`, `)}`),null)},[B]),H=(0,l.useCallback)((e,t)=>{let n=[`src`,`text`,`outputData`,`output`,`_loading`,`_error`,`_executionStatus`,`_contentSize`,`fileName`,`fileType`,`fileSize`,`resourceType`],r=R.current.get(e)||{},i={...r};console.log(`[Core updateMediaData] èŠ‚ç‚¹ ${e}:`,{currentMedia:r,updates:t,willMerge:i}),Object.keys(t).forEach(r=>{n.includes(r)?t[r]===void 0?delete i[r]:i[r]=t[r]:console.warn(`[updateMediaData] å¿½ç•¥éžåª’ä½“å­—æ®µ "${r}" (èŠ‚ç‚¹ ${e})`,`\nå…è®¸çš„å­—æ®µ: ${n.join(`, `)}`)}),R.current.set(e,i),z.current.emit(e,i),console.log(`[Core updateMediaData] æ›´æ–°åŽ:`,i)},[]);(0,l.useImperativeHandle)(t,()=>({init:(e,t)=>{let n=t||te();return re.current=n,e&&(A(e),L.current?.setFlow&&(L.current.setFlow(e),setTimeout(()=>{L.current?.fitView()},10))),n},getFlow:()=>L.current?.getFlow?.()||k,setFlow:e=>{A(e),L.current?.setFlow&&L.current.setFlow(e)},runFlow:async()=>G(),fitView:()=>{L.current?.fitView()},getViewport:()=>L.current?.getViewport()||{x:0,y:0,zoom:1},getNode:e=>{let t=L.current?.getFlow?.();return t&&t.nodes.find(t=>t.id===e)||null},getUpstreamNodes:e=>{let t=L.current?.getFlow?.();if(!t)return[];let n=t.edges.filter(t=>t.target===e).map(e=>e.source);return t.nodes.filter(e=>n.includes(e.id)).map(e=>{let t=r.nodeDefinitions.find(t=>t.type===e.type),n=R.current.get(e.id)||{};return{id:e.id,type:e.type,label:t?.label||e.type,position:e.position,data:n}})},setNodeImage:(e,t)=>{V(e,[`image`,`video`,`audio`,`user-upload`],`setNodeImage`)&&H(e,{src:t})},setNodeVideo:(e,t)=>{V(e,`video`,`setNodeVideo`)&&H(e,{src:t})},setNodeAudio:(e,t)=>{V(e,`audio`,`setNodeAudio`)&&H(e,{src:t})},setNodeText:(e,t)=>{V(e,`text`,`setNodeText`)&&H(e,{text:t})},setNodeOutput:(e,t)=>{B(e)?H(e,{outputData:t}):console.warn(`[setNodeOutput] èŠ‚ç‚¹ä¸å­˜åœ¨: ${e}`)},setNodeContent:(e,t)=>{H(e,t)},clearNodeContent:e=>{let{src:t,text:n,outputData:r,...i}=R.current.get(e)||{};R.current.set(e,i),z.current.emit(e,i)},setNodeLoading:e=>{let t=R.current.get(e)||{};R.current.set(e,{...t,_loading:!0}),z.current.emit(e,R.current.get(e))},clearNodeLoading:e=>{let t=R.current.get(e)||{};console.log(`[Core clearNodeLoading] èŠ‚ç‚¹ ${e} æ¸…é™¤å‰:`,t);let n={...t};delete n._loading,R.current.set(e,n),z.current.emit(e,n),console.log(`[Core clearNodeLoading] èŠ‚ç‚¹ ${e} æ¸…é™¤åŽ:`,n)},setNodeError:(e,t)=>{let n=R.current.get(e)||{};R.current.set(e,{...n,_error:t}),z.current.emit(e,R.current.get(e))},clearNodeError:e=>{let t={...R.current.get(e)||{}};delete t._error,R.current.set(e,t),z.current.emit(e,t)},updateNodeMedia:(e,t)=>{let n={...R.current.get(e)||{},...t};Object.keys(n).forEach(e=>{n[e]===void 0&&delete n[e]}),R.current.set(e,n),z.current.emit(e,n)},batchUpdateNodeMedia:e=>{e.forEach(({nodeId:e,data:t})=>{let n={...R.current.get(e)||{},...t};R.current.set(e,n)}),z.current.batchEmit(e.map(e=>({nodeId:e.nodeId,data:R.current.get(e.nodeId)})))},getNodeMedia:e=>R.current.get(e)||{},updateNodeStatus:(e,t)=>{let n={...R.current.get(e)||{},_executionStatus:t};R.current.set(e,n),z.current.emit(e,n)}}));let ie=(0,l.useCallback)(e=>{A(e),d?.(e)},[d]),U=(0,l.useCallback)(e=>{e.length===1?I(e[0]):I(null),_?.(e)},[_]),G=async()=>{if(!j){M(!0),p?.(k);try{return await ne.current.runFlow(k,(e,t)=>{})}catch(e){console.error(`Flow execution failed`,e)}finally{M(!1)}}},ae=async e=>{if(j)return;if(h){M(!0);try{await h(e)}catch(t){console.error(`Group ${e} execution failed`,t)}finally{M(!1)}return}let t=k.nodes.filter(t=>t.groupId===e);if(t.length===0)return;let n=new Set(t.map(e=>e.id)),r={nodes:t,edges:k.edges.filter(e=>n.has(e.source)&&n.has(e.target)),groups:[],meta:k.meta};M(!0);try{await ne.current.runFlow(r,(e,t)=>{})}catch(t){console.error(`Group ${e} execution failed`,t)}finally{M(!1)}},oe=async e=>{if(!N){P(e);try{m?await m(e):console.warn(`No onNodeRun handler provided`)}catch(e){console.error(`Node execution failed:`,e)}finally{P(null)}}},K=(0,l.useCallback)((e,t)=>{switch(e){case`create`:C?.(t);break;case`delete`:w?.(t);break;case`update`:case`move`:E?.(t);break;case`ungroup`:L.current?.ungroup&&L.current.ungroup(t.id);break;case`run`:ae(t.id);break;case`save`:let e=k.groups?.find(e=>e.id===t.id);if(!e){console.warn(`Group ${t.id} not found for save`);return}let n=k.nodes.filter(e=>e.groupId===t.id),r=new Set(n.map(e=>e.id)),i={nodes:n,edges:k.edges.filter(e=>r.has(e.source)&&r.has(e.target)),groups:[e],meta:k.meta};g?.(t.id,i);break}},[C,w,E,k,h,g]),ce=(0,l.useCallback)(e=>R.current.get(e)||{},[]),q=(0,l.useCallback)((e,t)=>{let n=R.current.get(e)||{};console.log(`[Core updateNodeMedia] èŠ‚ç‚¹ ${e}:`,{currentMedia:n,newMedia:t,willMerge:{...n,...t}});let r={...n,...t};Object.keys(r).forEach(e=>{r[e]===void 0&&delete r[e]}),R.current.set(e,r),z.current.emit(e,r),console.log(`[Core updateNodeMedia] æ›´æ–°åŽçš„ mediaMap:`,r)},[]);return(0,W.jsx)(se,{config:r,components:i,readOnly:o===`view`,onNodeRun:oe,onNodeDataChange:b,runningNodeId:N,isExecuting:j||!!N,onGroupAction:K,inspectingNodeId:F,mediaMap:R.current,mediaEmitter:z.current,getNodeMedia:ce,updateNodeMedia:q,renderNodeInspector:u,children:(0,W.jsx)(`div`,{className:`canvas-flow-container ${D||``}`,style:{width:`100%`,height:`100%`,position:`relative`,overflow:`hidden`,...O},children:(0,W.jsx)(J,{ref:L,initialFlow:n,readOnly:o===`view`,renderEmpty:c,onChange:ie,onSelectionChange:U,onNodeAdd:v,onNodeMove:y,onNodeDelete:ee,onNodeDataChange:b,onEdgeAdd:x,onEdgeDelete:S,onGroupAdd:C,onGroupDelete:w,onGroupUngroup:T,onGroupUpdate:E})})})});$.displayName=`CanvasFlow`;const Se=({onAction:e})=>(0,W.jsx)(`div`,{className:`cf-canvas-empty-state`,children:(0,W.jsxs)(`div`,{className:`cf-empty-instruction`,children:[(0,W.jsxs)(`div`,{className:`cf-double-click-badge`,children:[(0,W.jsx)(T,{size:14}),(0,W.jsx)(`span`,{children:`åŒå‡»`})]}),(0,W.jsx)(`span`,{className:`cf-instruction-text`,children:`ç”»å¸ƒè‡ªç”±ç”Ÿæˆ,æˆ–æŸ¥çœ‹å·¥ä½œæµæ¨¡æ¿`})]})});exports.ActionToolbar=ue,exports.AudioNode=ve,exports.CanvasEmptyState=Se,exports.CanvasFlow=$,exports.FloatingNodeMenu=ae,exports.GroupNode=de,exports.ImageNode=ge,exports.NodeEmptyState=Z,exports.NodeMediaEmitter=X,exports.StandardNodeType=V,exports.TextNode=me,exports.UploadNode=ye,exports.VideoNode=_e,exports.defaultCanvasConfig=xe,exports.defaultComponentRegistry=be;